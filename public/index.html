<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Family List</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#f4f3f1; --surface:#fff; --surface2:#f9f8f7;
  --border:#e4e2de; --border2:#ccc9c3;
  --text:#181714; --mid:#6a6760; --soft:#aaa59f;
  --blue:#2563eb; --blue-bg:#eff6ff;
  --shadow:0 1px 4px rgba(0,0,0,.07),0 2px 8px rgba(0,0,0,.04);
  --shadow2:0 4px 16px rgba(0,0,0,.1);
  --r:10px; --rl:14px;
  --food:#dc2626;--food-bg:#fef2f2;
  --toys:#7c3aed;--toys-bg:#f5f3ff;
  --clothes:#d97706;--clothes-bg:#fffbeb;
  --school:#2563eb;--school-bg:#eff6ff;
  --house:#059669;--house-bg:#ecfdf5;
  --health:#db2777;--health-bg:#fdf2f8;
  --fun:#ea580c;--fun-bg:#fff7ed;
  --other:#64748b;--other-bg:#f8fafc;
  --urgent:#dc2626;--normal:#16a34a;--sometime:#94a3b8;
  --header-h:56px;
  --nav-h:60px;
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
html,body{height:100%;}
body{
  font-family:'Inter',-apple-system,sans-serif;
  background:var(--bg);color:var(--text);
  font-size:14px;line-height:1.5;
}

/* ‚ïê‚ïê‚ïê MODAL ‚ïê‚ïê‚ïê */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);backdrop-filter:blur(4px);
  z-index:500;display:flex;align-items:center;justify-content:center;padding:1rem;}
.overlay.hidden{display:none;}
.modal{background:var(--surface);border:1px solid var(--border);border-radius:var(--rl);
  padding:1.5rem;max-width:320px;width:100%;box-shadow:var(--shadow2);}
.modal-icon{font-size:24px;margin-bottom:.5rem;}
.modal-title{font-size:15px;font-weight:700;margin-bottom:4px;}
.modal-body{font-size:13px;color:var(--mid);margin-bottom:1.25rem;line-height:1.6;}
.modal-btns{display:flex;gap:8px;justify-content:flex-end;}
.btn{display:inline-flex;align-items:center;gap:5px;padding:7px 14px;border-radius:var(--r);
  font-family:inherit;font-size:13px;font-weight:600;cursor:pointer;transition:all .12s;border:1px solid transparent;}
.btn-ghost{background:transparent;border-color:var(--border);color:var(--mid);}
.btn-ghost:hover{background:var(--bg);color:var(--text);}
.btn-danger{background:#dc2626;color:#fff;}
.btn-danger:hover{background:#b91c1c;}
.btn-primary{background:var(--blue);color:#fff;}
.btn-primary:hover{background:#1d4ed8;}
.btn-primary:disabled{opacity:.5;cursor:not-allowed;}

/* ‚ïê‚ïê‚ïê LOGIN ‚ïê‚ïê‚ïê */
#loginOverlay{position:fixed;inset:0;background:rgba(0,0,0,.5);backdrop-filter:blur(6px);
  z-index:400;display:flex;align-items:center;justify-content:center;padding:1rem;}
#loginOverlay.hidden{display:none;}
.login-box{background:var(--surface);border:1px solid var(--border);border-radius:var(--rl);
  padding:2rem;max-width:340px;width:100%;box-shadow:var(--shadow2);}
.login-box h2{font-size:19px;font-weight:700;margin-bottom:4px;}
.login-box p{font-size:13px;color:var(--mid);margin-bottom:1.25rem;}
.chips{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:1rem;}
.chip{padding:6px 13px;border:1px solid var(--border);border-radius:20px;background:var(--surface2);
  font-size:13px;font-weight:500;cursor:pointer;color:var(--mid);transition:all .12s;}
.chip:hover{border-color:var(--blue);color:var(--blue);background:var(--blue-bg);}
.login-sep{font-size:10px;font-weight:700;color:var(--soft);text-transform:uppercase;letter-spacing:.07em;margin-bottom:.75rem;}
.login-row{display:flex;gap:7px;}
.login-row input{flex:1;border:1px solid var(--border);border-radius:var(--r);padding:8px 11px;
  font-family:inherit;font-size:13px;color:var(--text);background:var(--surface2);outline:none;}
.login-row input:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(37,99,235,.1);}

/* ‚ïê‚ïê‚ïê HEADER ‚ïê‚ïê‚ïê */
header{
  position:fixed;top:0;left:0;right:0;z-index:100;
  height:var(--header-h);
  background:rgba(255,255,255,.94);backdrop-filter:blur(12px);
  border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;
  padding:0 1.25rem;
}
.h-brand{font-size:16px;font-weight:700;letter-spacing:-.2px;}
.h-right{display:flex;align-items:center;gap:8px;}
.h-badge{background:var(--blue);color:#fff;font-size:11px;font-weight:700;
  padding:2px 8px;border-radius:20px;}
.h-user{display:flex;align-items:center;gap:5px;background:var(--surface2);
  border:1px solid var(--border);border-radius:20px;padding:4px 10px;
  font-size:12px;font-weight:600;color:var(--mid);cursor:pointer;transition:all .12s;}
.h-user:hover{border-color:var(--blue);color:var(--blue);}
.h-sub{font-size:11px;color:var(--soft);margin-top:1px;}

/* ‚ïê‚ïê‚ïê DESKTOP LAYOUT ‚ïê‚ïê‚ïê */
.app-shell{
  position:fixed;
  top:var(--header-h);left:0;right:0;bottom:0;
  display:flex;
}

.sidebar{
  width:320px;flex-shrink:0;
  background:var(--surface);border-right:1px solid var(--border);
  overflow-y:auto;overflow-x:hidden;
  display:flex;flex-direction:column;
}
.sb-tabs{display:flex;border-bottom:1px solid var(--border);flex-shrink:0;
  position:sticky;top:0;z-index:2;background:var(--surface);}
.sb-tab{flex:1;padding:11px 6px;border:none;background:transparent;
  font-family:inherit;font-size:12px;font-weight:600;color:var(--soft);cursor:pointer;
  border-bottom:2px solid transparent;margin-bottom:-1px;transition:all .12s;}
.sb-tab.active{color:var(--blue);border-bottom-color:var(--blue);}
.sb-panel{display:none;padding:1.125rem;flex:1;}
.sb-panel.active{display:block;}

.main{
  flex:1;min-width:0;
  overflow-y:auto;overflow-x:hidden;
  padding:1.25rem 1.5rem;
  background:var(--bg);
}

/* ‚ïê‚ïê‚ïê FORM FIELDS ‚ïê‚ïê‚ïê */
.field{margin-bottom:.8rem;}
.field label{display:block;font-size:10px;font-weight:700;color:var(--soft);
  text-transform:uppercase;letter-spacing:.07em;margin-bottom:3px;}
.field input,.field textarea,.field select{
  width:100%;border:1px solid var(--border);border-radius:var(--r);
  padding:7px 10px;font-family:inherit;font-size:13px;color:var(--text);
  background:var(--surface2);outline:none;transition:border-color .12s,box-shadow .12s;}
.field input:focus,.field textarea:focus,.field select:focus{
  border-color:var(--blue);box-shadow:0 0 0 3px rgba(37,99,235,.08);background:var(--surface);}
.field textarea{resize:vertical;min-height:55px;line-height:1.5;}
.field input[readonly]{background:var(--blue-bg);color:var(--blue);font-weight:600;cursor:default;border-color:transparent;}

.cat-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:4px;}
.cat-btn{display:flex;flex-direction:column;align-items:center;padding:6px 2px;
  border:1px solid var(--border);border-radius:var(--r);background:var(--surface2);
  cursor:pointer;font-family:inherit;font-size:10px;font-weight:600;color:var(--soft);
  transition:all .12s;gap:2px;}
.cat-btn span{font-size:16px;}
.cat-btn:hover{border-color:var(--blue);color:var(--blue);background:var(--blue-bg);}
.cat-btn.sc-food{border-color:var(--food);background:var(--food-bg);color:var(--food);}
.cat-btn.sc-toys{border-color:var(--toys);background:var(--toys-bg);color:var(--toys);}
.cat-btn.sc-clothes{border-color:var(--clothes);background:var(--clothes-bg);color:var(--clothes);}
.cat-btn.sc-school{border-color:var(--school);background:var(--school-bg);color:var(--school);}
.cat-btn.sc-house{border-color:var(--house);background:var(--house-bg);color:var(--house);}
.cat-btn.sc-health{border-color:var(--health);background:var(--health-bg);color:var(--health);}
.cat-btn.sc-fun{border-color:var(--fun);background:var(--fun-bg);color:var(--fun);}
.cat-btn.sc-other{border-color:var(--other);background:var(--other-bg);color:var(--other);}

.urg-row{display:grid;grid-template-columns:repeat(3,1fr);gap:4px;}
.urg-btn{padding:7px 4px;border:1px solid var(--border);border-radius:var(--r);
  background:var(--surface2);font-family:inherit;font-size:11px;font-weight:600;
  cursor:pointer;color:var(--soft);transition:all .12s;}
.urg-btn:hover{border-color:var(--blue);color:var(--blue);}
.urg-btn.su-urgent{border-color:var(--urgent);background:#fef2f2;color:var(--urgent);}
.urg-btn.su-normal{border-color:var(--normal);background:#f0fdf4;color:var(--normal);}
.urg-btn.su-sometime{border-color:var(--sometime);background:#f8fafc;color:var(--sometime);}

.add-btn{width:100%;padding:9px;background:var(--blue);color:#fff;border:none;
  border-radius:var(--r);font-family:inherit;font-size:13px;font-weight:600;
  cursor:pointer;transition:all .12s;margin-top:.25rem;}
.add-btn:hover{background:#1d4ed8;}
.add-btn:disabled{opacity:.5;cursor:not-allowed;}

/* ‚ïê‚ïê‚ïê LISTS TAB ‚ïê‚ïê‚ïê */
.sec-label{font-size:10px;font-weight:700;color:var(--soft);text-transform:uppercase;
  letter-spacing:.07em;margin-bottom:.5rem;}
.tpl-name{width:100%;border:1px solid var(--border);border-radius:var(--r);
  padding:7px 10px;font-family:inherit;font-size:13px;font-weight:600;color:var(--text);
  background:var(--surface2);outline:none;margin-bottom:.6rem;}
.tpl-name:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(37,99,235,.08);}
.tpl-area{border:1px solid var(--border);border-radius:var(--r);background:var(--surface2);
  min-height:52px;padding:5px;display:flex;flex-direction:column;gap:4px;
  margin-bottom:.6rem;max-height:180px;overflow-y:auto;}
.tpl-empty{text-align:center;color:var(--soft);font-size:12px;padding:.75rem 0;}
.ti-row{background:var(--surface);border:1px solid var(--border);border-radius:7px;padding:5px 6px;}
.ti-top{display:grid;grid-template-columns:1fr auto auto auto;align-items:center;gap:4px;}
.ti-top input{border:none;background:transparent;font-family:inherit;font-size:13px;
  font-weight:500;color:var(--text);outline:none;min-width:0;padding:1px 3px;border-radius:4px;}
.ti-top input:focus{background:var(--bg);}
.ti-top select{border:1px solid var(--border);border-radius:5px;background:var(--surface2);
  font-family:inherit;font-size:10px;color:var(--mid);padding:2px 2px;outline:none;cursor:pointer;}
.ti-note-inp{width:100%;border:none;background:transparent;font-family:inherit;font-size:11px;
  color:var(--soft);outline:none;padding:1px 4px;}
.ti-del{background:none;border:none;cursor:pointer;color:var(--soft);font-size:13px;
  padding:2px 4px;border-radius:4px;transition:all .1s;line-height:1;}
.ti-del:hover{color:#dc2626;background:#fef2f2;}
.ti-adder{display:flex;flex-direction:column;gap:4px;margin-bottom:.6rem;}
.ti-adder input,.ti-adder textarea{width:100%;border:1px solid var(--border);border-radius:var(--r);
  padding:7px 10px;font-family:inherit;font-size:13px;color:var(--text);background:var(--surface2);outline:none;}
.ti-adder textarea{resize:none;line-height:1.4;}
.ti-r2{display:flex;gap:4px;}
.ti-r2 select{flex:1;border:1px solid var(--border);border-radius:var(--r);padding:7px 5px;
  font-family:inherit;font-size:12px;color:var(--mid);background:var(--surface2);outline:none;cursor:pointer;}
.ti-r2 .ti-add-btn{flex-shrink:0;padding:7px 13px;background:var(--text);color:#fff;border:none;
  border-radius:var(--r);font-family:inherit;font-size:13px;font-weight:600;cursor:pointer;transition:all .12s;}
.save-list-btn{width:100%;padding:8px;background:var(--text);color:#fff;border:none;
  border-radius:var(--r);font-family:inherit;font-size:13px;font-weight:600;cursor:pointer;
  transition:all .12s;margin-bottom:.875rem;}
.divider{height:1px;background:var(--border);margin:.75rem 0;}
.saved-cards{display:flex;flex-direction:column;gap:5px;}
.sc-card{border:1px solid var(--border);border-radius:var(--r);background:var(--surface2);overflow:hidden;}
.sc-head{display:flex;align-items:center;gap:6px;padding:8px 10px;flex-wrap:wrap;}
.sc-name{flex:1;font-size:13px;font-weight:600;min-width:0;}
.sc-cnt{font-size:11px;color:var(--soft);flex-shrink:0;}
.sc-acts{display:flex;gap:3px;flex-shrink:0;}
.sc-b{padding:4px 8px;border-radius:6px;font-family:inherit;font-size:11px;font-weight:600;
  cursor:pointer;transition:all .12s;border:1px solid transparent;}
.sc-b-add{background:var(--blue);color:#fff;}
.sc-b-edit{background:var(--surface);border-color:var(--border);color:var(--mid);}
.sc-b-del{background:var(--surface);border-color:var(--border);color:var(--soft);}
.sc-b-del:hover{border-color:#dc2626;color:#dc2626;background:#fef2f2;}
.sc-b-tog{background:none;border:1px solid var(--border);color:var(--soft);font-size:11px;}
.sc-preview{display:none;border-top:1px solid var(--border);background:var(--surface);}
.sc-pi{display:flex;align-items:center;gap:7px;padding:5px 10px;font-size:12px;
  color:var(--mid);border-bottom:1px solid var(--border);}
.sc-pi-name{flex:1;font-weight:500;color:var(--text);}

/* ‚ïê‚ïê‚ïê MAIN ‚Äî FILTERS + ITEMS ‚ïê‚ïê‚ïê */
.filter-row{display:flex;gap:5px;overflow-x:auto;scrollbar-width:none;margin-bottom:.875rem;padding-bottom:2px;}
.filter-row::-webkit-scrollbar{display:none;}
.f-chip{flex-shrink:0;padding:5px 11px;border:1px solid var(--border);border-radius:20px;
  background:var(--surface);font-family:inherit;font-size:12px;font-weight:500;
  cursor:pointer;color:var(--mid);transition:all .12s;white-space:nowrap;}
.f-chip.active{background:var(--text);color:#fff;border-color:var(--text);}
.f-chip.list-chip.active{background:var(--blue);border-color:var(--blue);}

.list-filter-row{display:flex;gap:5px;overflow-x:auto;scrollbar-width:none;
  margin-bottom:.75rem;padding-bottom:2px;align-items:center;}
.lf-label{font-size:10px;font-weight:700;color:var(--soft);text-transform:uppercase;
  letter-spacing:.06em;white-space:nowrap;flex-shrink:0;}

.toolbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:.75rem;gap:8px;}
.result-info{font-size:12px;color:var(--soft);font-weight:500;}
.clear-btn{padding:5px 10px;border:1px solid var(--border);border-radius:var(--r);
  background:var(--surface);font-family:inherit;font-size:12px;font-weight:500;
  color:var(--mid);cursor:pointer;transition:all .12s;}

.items-list{display:flex;flex-direction:column;gap:5px;}
.item-card{background:var(--surface);border:1px solid var(--border);
  border-left:3px solid var(--border);border-radius:var(--rl);
  padding:11px 13px;display:flex;align-items:flex-start;gap:10px;
  transition:all .15s;box-shadow:var(--shadow);}
.item-card.done{opacity:.4;}
.item-card.done .ic-name{text-decoration:line-through;}
.item-card.ul-urgent{border-left-color:var(--urgent);}
.item-card.ul-normal{border-left-color:var(--normal);}
.item-card.ul-sometime{border-left-color:var(--sometime);}
@keyframes popIn{from{opacity:0;transform:translateY(-4px);}to{opacity:1;transform:translateY(0);}}
.item-card{animation:popIn .15s ease;}

.chk{width:18px;height:18px;border-radius:4px;border:1.5px solid var(--border2);
  background:transparent;cursor:pointer;flex-shrink:0;transition:all .12s;
  display:flex;align-items:center;justify-content:center;font-size:11px;margin-top:2px;}
.chk.on{background:var(--normal);border-color:var(--normal);color:#fff;}

.ic-body{flex:1;min-width:0;}
.ic-top{display:flex;align-items:center;gap:5px;flex-wrap:wrap;margin-bottom:2px;}
.ic-name{font-size:14px;font-weight:600;flex:1;min-width:0;}
.cat-tag{font-size:10px;font-weight:600;padding:1px 7px;border-radius:20px;flex-shrink:0;}
.ct-food{background:var(--food-bg);color:var(--food);}
.ct-toys{background:var(--toys-bg);color:var(--toys);}
.ct-clothes{background:var(--clothes-bg);color:var(--clothes);}
.ct-school{background:var(--school-bg);color:var(--school);}
.ct-house{background:var(--house-bg);color:var(--house);}
.ct-health{background:var(--health-bg);color:var(--health);}
.ct-fun{background:var(--fun-bg);color:var(--fun);}
.ct-other{background:var(--other-bg);color:var(--other);}
.urg-tag{font-size:10px;font-weight:600;padding:1px 7px;border-radius:20px;flex-shrink:0;}
.ut-urgent{background:#fef2f2;color:var(--urgent);}
.ut-normal{background:#f0fdf4;color:var(--normal);}
.ut-sometime{background:#f8fafc;color:var(--sometime);}
.ic-note{font-size:12px;color:var(--mid);margin-top:2px;line-height:1.5;}
.ic-meta{font-size:11px;color:var(--soft);margin-top:3px;display:flex;gap:6px;}
.ic-acts{display:flex;gap:1px;flex-shrink:0;}
.ia{background:none;border:none;cursor:pointer;color:var(--soft);font-size:13px;
  padding:3px 5px;border-radius:5px;transition:all .12s;line-height:1;}
.ia.del:hover{background:#fef2f2;color:#dc2626;}

.ic-edit{flex:1;display:flex;flex-direction:column;gap:5px;}
.ic-edit input,.ic-edit textarea,.ic-edit select{
  border:1px solid var(--border);border-radius:7px;padding:6px 9px;
  font-family:inherit;font-size:13px;color:var(--text);background:var(--surface2);outline:none;width:100%;}
.ic-edit-row{display:flex;gap:5px;}
.ic-edit-acts{display:flex;gap:5px;justify-content:flex-end;}

.empty{text-align:center;padding:4rem 2rem;color:var(--soft);}
.empty-icon{font-size:36px;margin-bottom:.5rem;opacity:.4;}
.empty-title{font-size:15px;font-weight:600;color:var(--mid);margin-bottom:3px;}

.toast{position:fixed;bottom:1.25rem;right:1.25rem;background:var(--text);color:#fff;
  padding:9px 15px;border-radius:var(--r);font-size:13px;font-weight:500;
  z-index:999;box-shadow:var(--shadow2);}
@keyframes toastIn{from{opacity:0;transform:translateY(5px);}to{opacity:1;transform:translateY(0);}}
.toast{animation:toastIn .15s ease;}

.mobile-nav{display:none;}

@media(max-width:700px){
  .app-shell{position:static;display:block;}
  body{padding-top:var(--header-h);padding-bottom:var(--nav-h);}
  .sidebar{width:100%;border-right:none;border-bottom:1px solid var(--border);overflow:visible;display:none;background:var(--surface);}
  .main{padding:.875rem 1rem;overflow:visible;}
  body.show-add .sidebar{display:block;}
  body.show-lists .sidebar{display:block;}
  .mobile-nav{display:flex;position:fixed;bottom:0;left:0;right:0;height:var(--nav-h);background:rgba(255,255,255,.97);backdrop-filter:blur(12px);border-top:1px solid var(--border);z-index:200;}
  .mn-btn{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:3px;background:none;border:none;font-size:10px;font-weight:600;color:var(--soft);}
  .mn-btn svg{width:20px;height:20px;}
  .mn-btn.active{color:var(--blue);border-top:2px solid var(--blue);}
}
</style>
</head>
<body>

<div class="overlay hidden" id="confirmModal">
  <div class="modal">
    <div class="modal-icon" id="mIcon">üóë</div>
    <div class="modal-title" id="mTitle">Are you sure?</div>
    <div class="modal-body" id="mBody">This cannot be undone.</div>
    <div class="modal-btns">
      <button class="btn btn-ghost" onclick="closeConfirm()">Cancel</button>
      <button class="btn btn-danger" id="mConfirmBtn">Delete</button>
    </div>
  </div>
</div>

<div id="loginOverlay">
  <div class="login-box">
    <h2>Family List</h2>
    <p>Who are you?</p>
    <div class="chips" id="savedChips"></div>
    <div class="login-sep">or enter your name</div>
    <div class="login-row">
      <input id="loginInput" type="text" placeholder="Your name‚Ä¶" maxlength="30" onkeydown="if(event.key==='Enter')doLogin()">
      <button class="btn btn-primary" onclick="doLogin()">Continue</button>
    </div>
  </div>
</div>

<header>
  <div>
    <div class="h-brand">üè† Family List</div>
    <div class="h-sub" id="hSub">Loading‚Ä¶</div>
  </div>
  <div class="h-right">
    <span class="h-badge" id="hCount">0</span>
    <button class="h-user" onclick="showLogin()">
      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
        <circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 3.6-7 8-7s8 3 8 7"/>
      </svg>
      <span id="hUser">‚Ä¶</span>
    </button>
  </div>
</header>

<div class="app-shell">
  <div class="sidebar" id="sidebar">
    <div class="sb-tabs">
      <button class="sb-tab active" id="sbTabAdd" onclick="sbTab('add')">Add Item</button>
      <button class="sb-tab" id="sbTabLists" onclick="sbTab('lists')">My Lists</button>
    </div>

    <div class="sb-panel active" id="sbPanelAdd">
      <div class="field"><label>Added by</label><input id="fWho" readonly></div>
      <div class="field"><label>Item name</label><input id="fName" placeholder="e.g. Milk‚Ä¶" maxlength="80"></div>
      <div class="field">
        <label>Category</label>
        <div class="cat-grid" id="catGrid">
          <button class="cat-btn" data-cat="food" onclick="pickCat(this)"><span>üõí</span>Food</button>
          <button class="cat-btn" data-cat="toys" onclick="pickCat(this)"><span>üß∏</span>Toys</button>
          <button class="cat-btn" data-cat="clothes" onclick="pickCat(this)"><span>üëï</span>Clothes</button>
          <button class="cat-btn" data-cat="school" onclick="pickCat(this)"><span>üéí</span>School</button>
          <button class="cat-btn" data-cat="house" onclick="pickCat(this)"><span>üè°</span>House</button>
          <button class="cat-btn" data-cat="health" onclick="pickCat(this)"><span>üíä</span>Health</button>
          <button class="cat-btn" data-cat="fun" onclick="pickCat(this)"><span>üéâ</span>Fun</button>
          <button class="cat-btn" data-cat="other" onclick="pickCat(this)"><span>üì¶</span>Other</button>
        </div>
      </div>
      <div class="field">
        <label>Priority</label>
        <div class="urg-row">
          <button class="urg-btn" data-urg="urgent" onclick="pickUrg(this)">Urgent</button>
          <button class="urg-btn su-normal" data-urg="normal" onclick="pickUrg(this)">Normal</button>
          <button class="urg-btn" data-urg="sometime" onclick="pickUrg(this)">Someday</button>
        </div>
      </div>
      <div class="field"><label>Note</label><textarea id="fNote"></textarea></div>
      <button class="add-btn" id="submitBtn" onclick="addItem()">Add to List</button>
    </div>

    <div class="sb-panel" id="sbPanelLists">
      <div class="sec-label" id="listBuilderLabel">New list</div>
      <input class="tpl-name" id="tplName" placeholder="List name‚Ä¶">
      <div class="tpl-area" id="tplArea"><div class="tpl-empty">No items yet</div></div>
      <div class="ti-adder">
        <input id="tiName" placeholder="Item name‚Ä¶">
        <div class="ti-r2">
          <select id="tiCat"><option value="food">üõí Food</option><option value="toys">üß∏ Toys</option><option value="other">üì¶ Other</option></select>
          <button class="ti-add-btn" onclick="addTplItem()">+ Add</button>
        </div>
      </div>
      <button class="save-list-btn" id="saveListBtn" onclick="saveTemplate()">Save List</button>
      <div class="divider"></div>
      <div class="sec-label">Saved lists</div>
      <div class="saved-cards" id="savedCards"></div>
    </div>
  </div>

  <div class="main" id="mainCol">
    <div class="filter-row" id="filterRow">
      <button class="f-chip active" onclick="setFilter(this,'all')">All</button>
      <button class="f-chip" onclick="setFilter(this,'urgent')">üî¥ Urgent</button>
    </div>
    <div class="list-filter-row" id="listFilterRow" style="display:none;"></div>
    <div class="toolbar">
      <span class="result-info" id="resultInfo"></span>
      <button class="clear-btn" onclick="confirmClearDone()">Clear done</button>
    </div>
    <div class="items-list" id="itemsList"></div>
  </div>
</div>

<nav class="mobile-nav">
  <button class="mn-btn active" onclick="mobileShow('list')">List</button>
  <button class="mn-btn" onclick="mobileShow('add')">Add</button>
  <button class="mn-btn" onclick="mobileShow('lists')">Lists</button>
</nav>

<script>
/* ‚ïê‚ïê‚ïê STORAGE ‚ïê‚ïê‚ïê */
// FIXED PORT TO 8080
const SRV = (location.hostname==='localhost'||location.hostname==='127.0.0.1') ? 'http://localhost:8080/api' : null;
let srvOk = false;
async function chkSrv(){if(!SRV)return;try{const r=await fetch(SRV+'/items',{signal:AbortSignal.timeout(2000)});srvOk=r.ok;}catch{}}
const LS='fl_v2';
function lsGet(){try{return JSON.parse(localStorage.getItem(LS)||'[]');}catch{return[];}}
function lsSave(a){localStorage.setItem(LS,JSON.stringify(a));}
function mkId(){return Date.now().toString(36)+Math.random().toString(36).slice(2,7);}
async function apiLoad(){if(srvOk&&SRV){try{const r=await fetch(SRV+'/items');if(r.ok){const d=await r.json();lsSave(d);return d;}}catch{}}return lsGet();}
async function apiAdd(p){const item={id:mkId(),...p,createdAt:new Date().toISOString(),done:false};const a=lsGet();a.unshift(item);lsSave(a);if(srvOk&&SRV){try{const r=await fetch(SRV+'/items',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(p)});if(r.ok){const s=await r.json();lsSave(lsGet().map(i=>i.id===item.id?s:i));return s;}}catch{}}return item;}
async function apiPatch(id,patch){lsSave(lsGet().map(i=>i.id===id?{...i,...patch}:i));if(srvOk&&SRV){try{await fetch(SRV+'/items/'+id,{method:'PATCH',headers:{'Content-Type':'application/json'},body:JSON.stringify(patch)});}catch{}}}
async function apiDel(id){lsSave(lsGet().filter(i=>i.id!==id));if(srvOk&&SRV){try{await fetch(SRV+'/items/'+id,{method:'DELETE'});}catch{}}}
async function apiClrDone(){lsSave(lsGet().filter(i=>!i.done));if(srvOk&&SRV){try{await fetch(SRV+'/items/done/all',{method:'DELETE'});}catch{}}}

/* ‚ïê‚ïê‚ïê CONFIRM (FIXED) ‚ïê‚ïê‚ïê */
let _cr=null;
function confirm2(title,body,icon='üóë'){
  closeConfirm(); // Clear any existing listener
  return new Promise(res=>{
    _cr=res;
    document.getElementById('mIcon').textContent=icon;
    document.getElementById('mTitle').textContent=title;
    document.getElementById('mBody').textContent=body;
    
    // Assign fresh click listener to the button
    const btn = document.getElementById('mConfirmBtn');
    btn.onclick = () => {
      if(_cr) _cr(true);
      _cr = null;
      closeConfirm();
    };
    
    document.getElementById('confirmModal').classList.remove('hidden');
  });
}
function closeConfirm(){
  document.getElementById('confirmModal').classList.add('hidden');
  if(_cr){ _cr(false); _cr=null; }
}
document.getElementById('confirmModal').addEventListener('click',e=>{if(e.target===e.currentTarget)closeConfirm();});

/* ‚ïê‚ïê‚ïê LOGIN ‚ïê‚ïê‚ïê */
let WHO=null;
function initLogin(){WHO=localStorage.getItem('fl_who');if(WHO){applyUser(WHO,false);}else{renderChips();document.getElementById('loginOverlay').classList.remove('hidden');}}
function getNames(){try{return JSON.parse(localStorage.getItem('fl_names')||'[]');}catch{return[];}}
function addName(n){const a=getNames();if(!a.includes(n)){a.unshift(n);if(a.length>8)a.pop();localStorage.setItem('fl_names',JSON.stringify(a));}}
function renderChips(){document.getElementById('savedChips').innerHTML=getNames().map(n=>`<button class="chip" onclick="loginAs('${esc(n)}')">${esc(n)}</button>`).join('');}
function loginAs(n){applyUser(n,true);}
function doLogin(){const n=document.getElementById('loginInput').value.trim();if(!n){toast('Enter name');return;}applyUser(n,true);}
function applyUser(n,save){WHO=n;if(save){localStorage.setItem('fl_who',n);addName(n);}document.getElementById('fWho').value=n;document.getElementById('hUser').textContent=n;document.getElementById('loginOverlay').classList.add('hidden');load();}
function showLogin(){renderChips();document.getElementById('loginInput').value='';document.getElementById('loginOverlay').classList.remove('hidden');}

/* ‚ïê‚ïê‚ïê APP LOGIC ‚ïê‚ïê‚ïê */
let items=[],selCat=null,selUrg='normal',activeF='all',activeListF=null,editId=null;
const CE={food:'üõí',toys:'üß∏',clothes:'üëï',school:'üéí',house:'üè°',health:'üíä',fun:'üéâ',other:'üì¶'};
const UL={urgent:'Urgent',normal:'Normal',sometime:'Someday'};
const UC={urgent:'#dc2626',normal:'#16a34a',sometime:'#94a3b8'};
const CATS=['food','toys','clothes','school','house','health','fun','other'];

function sbTab(t){
  document.getElementById('sbPanelAdd').classList.toggle('active',t==='add');
  document.getElementById('sbPanelLists').classList.toggle('active',t==='lists');
  if(t==='lists')renderSavedCards();
}

function mobileShow(v){
  document.body.classList.remove('show-add','show-lists');
  if(v==='add') { document.body.classList.add('show-add'); sbTab('add'); }
  else if(v==='lists') { document.body.classList.add('show-lists'); sbTab('lists'); }
}

function pickCat(btn){document.querySelectorAll('#catGrid .cat-btn').forEach(b=>b.className='cat-btn');selCat=btn.dataset.cat;btn.classList.add('sc-'+selCat);}
function pickUrg(btn){document.querySelectorAll('.urg-btn').forEach(b=>b.className='urg-btn');selUrg=btn.dataset.urg;btn.classList.add('su-'+selUrg);}
function setFilter(btn,f){activeF=f;render();}

async function load(){items=await apiLoad();render();updateHeader();}
function updateHeader(){const o=items.filter(i=>!i.done).length;document.getElementById('hCount').textContent=o;document.getElementById('hSub').textContent=o===0?'All done!':o+' needed';}

function render(){
  const el=document.getElementById('itemsList');
  let f=[...items];
  if(activeF==='urgent') f=f.filter(i=>i.urgency==='urgent'&&!i.done);
  document.getElementById('resultInfo').textContent=f.length+' items';
  el.innerHTML=f.map(item=>`
    <div class="item-card ${item.done?'done':''} ul-${item.urgency}">
      <button class="chk ${item.done?'on':''}" onclick="toggleDone('${item.id}',${!item.done})">${item.done?'‚úì':''}</button>
      <div class="ic-body">
        <div class="ic-top"><span class="ic-name">${esc(item.name)}</span></div>
        <div class="ic-meta">by ${esc(item.who)} ¬∑ ${ago(item.createdAt)}</div>
      </div>
      <div class="ic-acts">
        <button class="ia del" onclick="confDelItem('${item.id}','${esc(item.name)}')">üóë</button>
      </div>
    </div>`).join('');
}

async function addItem(){
  const name=document.getElementById('fName').value.trim();
  if(!name||!selCat){toast('Missing fields');return;}
  const item=await apiAdd({name,who:WHO,category:selCat,urgency:selUrg});
  items.unshift(item);render();updateHeader();
  document.getElementById('fName').value='';toast('Added!');
}

async function toggleDone(id,done){await apiPatch(id,{done});const i=items.findIndex(x=>x.id===id);if(i!==-1)items[i].done=done;render();updateHeader();}
async function confDelItem(id,name){const ok=await confirm2('Delete?',`Remove "${name}"?`);if(ok){await apiDel(id);items=items.filter(i=>i.id!==id);render();updateHeader();toast('Deleted');}}
async function confirmClearDone(){const ok=await confirm2('Clear?','Remove all completed?');if(ok){await apiClrDone();items=items.filter(i!=>!i.done);render();updateHeader();}}

/* ‚ïê‚ïê‚ïê LISTS/TEMPLATES ‚ïê‚ïê‚ïê */
let tplItems=[];
function getTpls(){return JSON.parse(localStorage.getItem('fl_tpls')||'[]');}
function setTpls(a){localStorage.setItem('fl_tpls',JSON.stringify(a));}

function addTplItem(){
  const name=document.getElementById('tiName').value.trim();
  if(!name)return;
  tplItems.push({name,category:document.getElementById('tiCat').value,urgency:'normal'});
  document.getElementById('tiName').value='';renderTplItems();
}
function renderTplItems(){
  document.getElementById('tplArea').innerHTML=tplItems.map((it,i)=>`<div>${esc(it.name)} <button onclick="tplItems.splice(${i},1);renderTplItems()">‚úï</button></div>`).join('');
}
function saveTemplate(){
  const name=document.getElementById('tplName').value.trim();
  if(!name||!tplItems.length)return;
  const tpls=getTpls();
  tpls.unshift({id:Date.now().toString(),name,items:[...tplItems]});
  setTpls(tpls);tplItems=[];renderTplItems();renderSavedCards();toast('Saved!');
}
async function delTpl(id,name){const ok=await confirm2('Delete list?',`Remove "${name}"?`);if(ok){setTpls(getTpls().filter(t=>t.id!==id));renderSavedCards();toast('Deleted');}}

function renderSavedCards(){
  const tpls=getTpls();
  document.getElementById('savedCards').innerHTML=tpls.map(t=>`
    <div class="sc-card">
      <div class="sc-head">
        <span class="sc-name">${esc(t.name)}</span>
        <button class="sc-b-del" onclick="delTpl('${t.id}','${esc(t.name)}')">üóë</button>
      </div>
    </div>`).join('');
}

function esc(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
function ago(iso){const s=Math.floor((Date.now()-new Date(iso))/1000);return s<60?'now':Math.floor(s/60)+'m';}
function toast(m){const t=document.createElement('div');t.className='toast';t.textContent=m;document.body.appendChild(t);setTimeout(()=>t.remove(),2000);}

chkSrv().then(()=>initLogin());
</script>
</body>
</html>